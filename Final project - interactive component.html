<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Final project - interactive component</title>
		<script src="https://d3js.org/d3.v4.min.js"></script>

	</head>

	<style>
		body {
	   		
	   		background: linear-gradient(to bottom right, #ccccff 3%, #ff99cc 94%);
	   		font-family: 'Gotham', Gotham Medium, sans-serif; 	

		}

		.dropdown select option[disabled]{
  			display: none; 
		}


	</style>
	<body>

	 	<h1 > How well do <i>you</i> know DSI's favorite songs? <h2>


	 	<h2>Rules</h2>

	 	<p>
	 	We made a Spotify playlist of the DSI's favorite songs from 2017 and analyzed 8 audio features. Now it's your turn to learn about these features by listening to the songs and guessing the values!
	 	</p>

	 	<ul>
		 	<li> Step 1: Pick a song to listen to.
		 	</li>

		 	<li> Step 2: Select the song you picked. 
	 		</li>

	 		<li> Step 3: Venture a guess!
		 	</li>

		 	<li> Step 4: See how close you were to the actual answer and how that song compares to the averages over all DSI songs.
		 	</li>

	 	</ul>

	 

	  <h2>Description of Audio features</h2>

	 <div class="features">

	 <ul>
	 	<li> Danceability: Danceability describes how suitable a track is for dancing based on a combination of musical elements including tempo, rhythm stability, beat strength, and overall regularity. Values range from 0.0 to 1.0, with 1.0 being the most danceable.
	 	</li>

	 	<li> Energy: Energy represents a perceptual measure of intensity and activity. Values range from 0.0 to 1.0, with 1.0 being the highest energy.
	 	</li>

	 	<li> Loudness: Loudness is the quality of a sound that is the primary psychological correlate of physical strength (amplitude). Values range between -60 and 0 db, with 0 being the loudest.
	 	</li>

	 	<li> Valence: Valence describes the musical positiveness conveyed by a track. Values range from 0.0 to 1.0, with 1.0 being the most positive/happy/cheerful.
	 	</li>

	 	<li> Tempo: Tempo represents the overall estimated tempo of a track in beats per minute (BPM). Values typically range from 0 to 250 bpm.
	 	</li>

	 	<li> Acousticness: Acousticness is a confidence measure of whether the track is acoustic. Values range from 0.0 to 1.0, with 1.0 being the most acoustic.
	 	</li>

	 	<li> Speechiness: Speechiness detects the presence of spoken words in a track. Values range from 0.0 to 1.0, with values above 0.66 describing tracks that are made entirely of spoken word and values below 0.33 representing all music.
	 	</li>

	 	<li> Track_Popularity: Spotify's track popularity rating transformed from 0 to 100 to 0.0 to 1.0. 
	 	</li>

	 </ul>

	</div>

		<h3>Step 1: Pick a song to play.</h3>

		<iframe src="https://open.spotify.com/embed/user/22ugjl3xvvzgwtbwi3ubpt72a/playlist/1rm6N5GtJXKIsPk5H3fcoN" width="500" height="500" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

		<h3>Step 2: Select the song you picked.</h3>


	<div class = "dropdown">

	<select id= "selected">
                                              
  		<option name= "song" value="humble">HUMBLE</option>
  		<option name= "song" value="shape of you">Shape of You</option>
  		<option name= "song" value="starboy">Starboy</option>
  		<option name= "song" value="another day of sun">Another Day Of Sun - From "La La Land" Soundtrack</option>
  		<option name= "song" value="bad and boujee">Bad and Boujee (feat. Lil Uzi Vert) </option>
  		<option name= "song" value="despacito">Despacito - Remix </option>
  		<option name= "song" value="paris">Paris</option>
  		<option name= "song" value="slide">Slide (feat. Frank Ocean & Migos)</option>
  		<option name= "song" value="bounceback">Bounce Back</option>
  		<option name= "song" value="broccoli">Broccoli</option>

	</select>

	</div>

	<h3>Step 3: Venture a guess!  </h3>

		<script type="text/javascript">

			var song_value = "";
		
			//get the value of the dropdown list

			d3.select("select").on("change", function(){
    			song_value = d3.select("#selected").node().value;
    			//for testing
    			console.log(song_value);
    			d3.select("#test").text(song_value);

			});

			//order of features

			//danceability, energy, loudness, valence, tempo, acousticness, speechiness, track_popularity

			//features of the top 10 songs --> MAKE THIS INTO DICTIONARY

			var humble = [{key: 'Danceability', value:0.908}, 
							{key: 'Energy', value:0.621},
							{key: 'Loudness', value: 0.20097132}, 
							{key: 'Valence', value:0.421}, 
							{key: 'Tempo', value:0.6556520741}, 
							{key: 'Acousticness', value:0.000282},
							{key: 'Speechiness', value:0.1020}, 
							{key: 'Track Popularity', value:0.97530864}];

			var shape_of_you = [0.825, 0.652, -3.183, 0.931, 95.977, 0.581000, 0.0802, 0.00e+00]
			var star_boy = [0.678, 0.588, -7.015, 0.486, 186.005, 0.141000, 0.2760, 6.35e-06]
			var another_day_of_sun =[0.588, 0.742, -6.757, 0.824, 125.819, 0.016200, 0.0528, 3.98e-06]
			var bad_and_boujee = [0.927, 0.665, -5.313, 0.175, 127.076, 0.061000, 0.2440, 0.00e+00]
			var despacito = [0.694, 0.815, -4.328, 0.813, 88.931, 0.229000, 0.1200, 0.00e+00]
			var paris = [0.646, 0.644, -6.763, 0.251, 99.999, 0.024300, 0.0310, 0.00e+00]
			var slide = [0.736,	0.795, -3.299,	0.511, 104.066, 0.498000, 0.0545, 1.21e-06]
			var bounce_back = [0.788, 0.516, -6.807, 0.235, 81.497, 0.100000, 0.2190, 0.00e+00]
			var broccoli = [0.886, 0.525, -7.390, 0.708, 145.990, 0.236000, 0.1320, 0.00e+00]


			if (song_value == "humble"){
				d3.select("#test").text("humble");
			}


			//  Width and height of svg
			var w = 700;
			var h = 500;
			var margin = {top: 25, right: 0, bottom: 25,
      		left: 25};
  			var innerWidth = w - margin.left - margin.right;
  			var innerHeight = h - margin.top - margin.bottom;

			// y-axis min / max
		  	var ymin = 0.0;
		  	var ymax = 1.0;
		
			//		Scale functions
			var xScale = d3.scaleBand()
				.domain(['Danceability', 'Energy', 'Loudness', 'Valence', 'Tempo', 'Acousticness', 'Speechiness', 'Track Popularity'])
				.range([0, innerWidth])
				.paddingInner(.1);

			var yScale = d3.scaleLinear()
				.domain([ymin, ymax])
				.range([innerHeight, 0]);
			
			//    Define X axis and Y axis
			var xAxis = d3.axisBottom()
				.scale(xScale);

			var yAxis = d3.axisLeft()
				.scale(yScale);

			//    Create SVG element		
			var svg = d3.select("body")
				.append("svg")
				.attr("width", w)
				.attr("height", h)

			// svg.append("rect")
			// 	.attr("x", 0)
			// 	.attr("y", 0)
			// 	.attr("width", w)
			// 	.attr("height", h)
			// 	.attr("fill", "white");				
			
			//    Create axes
			svg.append("g")
				.attr("class", "yAxis")
				.attr("transform", `translate (${margin.left}, ${margin.top})`)
				.call(yAxis.ticks(10));

			svg.append("g")
				.attr("class", "xAxis")
				.attr("transform", `translate (${margin.left}, ${h - margin.bottom})`)
				.call(xAxis);
			
			//	Create initial bars
			var bardata = [{key: 'Danceability', value:.05}, 
							{key: 'Energy', value:.05},
							{key: 'Loudness', value: .05}, 
							{key: 'Valence', value:.05}, 
							{key: 'Tempo', value:.05}, 
							{key: 'Acousticness', value:.05},
							{key: 'Speechiness', value:.05}, 
							{key: 'Track Popularity', value:.05}];


			var bars = svg.append("g")
				.attr("id", "plot")
				.attr("transform", `translate (${margin.left}, ${margin.top})`)
				.selectAll("rect")
				.data(bardata, d => d.key);

			bars.enter().append("rect")
				.attr("x", d => xScale(d.key))
				.attr("y", d => yScale(d.value))
				.attr("width", xScale.bandwidth())
				.attr("height", d => innerHeight - yScale(d.value))
				.attr("fill", "purple")
				.call(d3.drag()
					.on("start", dragstart)
					.on("drag", dragging)
					.on("end", dragend));

			function dragstart(d){
				d3.select(this).raise().classed("active", true);
			};

			function dragging(d){
				d3.select(this)
					.attr("y", d.y = d3.event.y)
					.attr("height", d => innerHeight - d3.event.y);
			};

			function dragend(d){
				d3.select(this).classed("active", false);
			};

			//	This function isn't working right now, not selecting the bars, eventually it should add new bars with the actual values, was just using color to test the functionality of this
			
			function results(){
				svg.select("g").attr("id", "plot").selectAll("rect")
				.transition()
				.style("fill", "blue");

			}

		</script>

		<div class = "submit">
	  		<input type="button" value="Submit" onclick="results()"/>

		</div>
	</body>
</html>