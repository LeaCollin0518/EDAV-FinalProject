<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Final project - interactive component</title>
		<script src="https://d3js.org/d3.v4.min.js"></script>

	</head>



	<style>
		body {
	   		/*linear-gradient(to bottom right, #fa7268 3%, #66ccff 94%)*/
	   		background: linear-gradient(to top left, #66ffff 5%, #ffffcc 89%);
	   		font-family: 'Gotham', Gotham Medium, sans-serif; 	

		}




		.dropdown select option[disabled]{
  			display: none; 
		}


	</style>
	<body>

	 	<h1 > How well do <i>you</i> know DSI's favorite songs? <h2>


	 	<h2>Rules</h2>

	 	<p>
	 	We made a Spotify playlist of the DSI's favorite songs from 2017 and analyzed 8 audio features. Now it's your turn to learn about these features by listening to the songs and guessing the values!
	 	</p>

	 	<ul>
		 	<li> Step 1: Pick a song to listen to.
		 	</li>

		 	<li> Step 2: Select the song you picked. 
	 		</li>

	 		<li> Step 3: Venture a guess!
		 	</li>

		 	<li> Step 4: See how close you were to the actual answer and how that song compares to the averages over all DSI songs.
		 	</li>

	 	</ul>

	 

	  <h2>Description of Audio features</h2>

	 <div class="features">

	 <ul>
	 	<li> Danceability: Danceability describes how suitable a track is for dancing based on a combination of musical elements including tempo, rhythm stability, beat strength, and overall regularity. Values range from 0.0 to 1.0, with 1.0 being the most danceable.
	 	</li>

	 	<li> Energy: Energy represents a perceptual measure of intensity and activity. Values range from 0.0 to 1.0, with 1.0 being the highest energy.
	 	</li>

	 	<li> Loudness: Loudness is the quality of a sound that is the primary psychological correlate of physical strength (amplitude). Values range between -60 and 0 db, with 0 being the loudest.
	 	</li>

	 	<li> Valence: Valence describes the musical positiveness conveyed by a track. Values range from 0.0 to 1.0, with 1.0 being the most positive/happy/cheerful.
	 	</li>

	 	<li> Tempo: Tempo represents the overall estimated tempo of a track in beats per minute (BPM). Values typically range from 0 to 250 bpm.
	 	</li>

	 	<li> Acousticness: Acousticness is a confidence measure of whether the track is acoustic. Values range from 0.0 to 1.0, with 1.0 being the most acoustic.
	 	</li>

	 	<li> Speechiness: Speechiness detects the presence of spoken words in a track. Values range from 0.0 to 1.0, with values above 0.66 describing tracks that are made entirely of spoken word and values below 0.33 representing all music.
	 	</li>

	 	<li> Track_Popularity: Spotify's track popularity rating transformed from 0 to 100 to 0.0 to 1.0. 
	 	</li>

	 </ul>

	</div>

		<h3>Step 1: Pick a song to play.</h3>

		<iframe src="https://open.spotify.com/embed/user/22ugjl3xvvzgwtbwi3ubpt72a/playlist/1rm6N5GtJXKIsPk5H3fcoN" width="500" height="500" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>

		<h3>Step 2: Select the song you picked.</h3>


	<div class = "dropdown">

	<select id= "selected">
                                              
  		<option name= "song" value="humble">HUMBLE</option>
  		<option name= "song" value="shapeofyou">Shape of You</option>
  		<option name= "song" value="starboy">Starboy</option>
  		<option name= "song" value="another day of sun">Another Day Of Sun - From "La La Land" Soundtrack</option>
  		<option name= "song" value="bad and boujee">Bad and Boujee (feat. Lil Uzi Vert) </option>
  		<option name= "song" value="despacito">Despacito - Remix </option>
  		<option name= "song" value="paris">Paris</option>
  		<option name= "song" value="slide">Slide (feat. Frank Ocean & Migos)</option>
  		<option name= "song" value="bounceback">Bounce Back</option>
  		<option name= "song" value="broccoli">Broccoli</option>

	</select>

	</div>

	<h3>Step 3: Venture a guess!  </h3>

		<script type="text/javascript">

			var song_value = 'humble';
		
			//get the value of the dropdown list
			d3.select("select").on("change", function(){
    			song_value = d3.select("#selected").node().value;

    			//for testing
    			console.log(song_value);
    			d3.select("#test").text(song_value);

			});

			//order of features

			//danceability, energy, loudness, valence, tempo, acousticness, speechiness, track_popularity

			//features of the top 10 songs and all DSI
			var anotherdayofsun = [{key: 'Danceability', value: 0.588}, 
									{key: 'Energy', value: 0.742}, 
									{key: 'Loudness', value: 0.17345050899999997}, 
									{key: 'Valence', value: 0.8240000000000001}, 
									{key: 'Tempo', value: 0.424211694}, 
									{key: 'Acousticness', value: 0.0162}, 
									{key: 'Speechiness', value: 0.0528}, 
									{key: 'Track Popularity', value: 0.7654320990000001}];

			var badandboujee = [{key: 'Danceability', value: 0.927}, 
								{key: 'Energy', value: 0.665}, 
								{key: 'Loudness', value: 0.507400555}, 
								{key: 'Valence', value: 0.175}, 
								{key: 'Tempo', value: 0.43623718}, 
								{key: 'Acousticness', value: 0.061}, 
								{key: 'Speechiness', value: 0.244}, 
								{key: 'Track Popularity', value: 0.8888888890000001}];

			var bounceback = [{key: 'Danceability', value: 0.77}, 
								{key: 'Energy', value: 0.5670000000000001}, 
								{key: 'Loudness', value: 0.41836262700000004}, 
								{key: 'Valence', value: 0.26}, 
								{key: 'Tempo', value: 0.0}, 
								{key: 'Acousticness', value: 0.105}, 
								{key: 'Speechiness', value: 0.175}, 
								{key: 'Track Popularity', value: 0.8888888890000001}];

			var starboy = [{key: 'Danceability', value: 0.6779999999999999}, 
							{key: 'Energy', value: 0.588}, 
							{key: 'Loudness', value: 0.113783534}, 
							{key: 'Valence', value: 0.486}, 
							{key: 'Tempo', value: 1.0}, 
							{key: 'Acousticness', value: 0.141}, 
							{key: 'Speechiness', value: 0.276}, 
							{key: 'Track Popularity', value: 0.962962963}];

			var slide = [{key: 'Danceability', value: 0.736}, 
							{key: 'Energy', value: 0.795}, 
							{key: 'Loudness', value: 0.973172988}, 
							{key: 'Valence', value: 0.511}, 
							{key: 'Tempo', value: 0.21610477600000003}, 
							{key: 'Acousticness', value: 0.498}, 
							{key: 'Speechiness', value: 0.0545}, 
							{key: 'Track Popularity', value: 0.851851852}];

			var broccoli = [{key: 'Danceability', value: 0.8859999999999999}, 
							{key: 'Energy', value: 0.525}, 
							{key: 'Loudness', value: 0.027058278999999998}, 
							{key: 'Valence', value: 0.708}, 
							{key: 'Tempo', value: 0.617183912}, 
							{key: 'Acousticness', value: 0.23600000000000002}, 
							{key: 'Speechiness', value: 0.132}, 
							{key: 'Track Popularity', value: 0.7777777779999999}];

			var paris = [{key: 'Danceability', value: 0.6459999999999999}, 
							{key: 'Energy', value: 0.644}, 
							{key: 'Loudness', value: 0.172062905}, 
							{key: 'Valence', value: 0.251}, 
							{key: 'Tempo', value: 0.177196541}, 
							{key: 'Acousticness', value: 0.0243}, 
							{key: 'Speechiness', value: 0.031}, 
							{key: 'Track Popularity', value: 0.8888888890000001}];

			var humble = [{key: 'Danceability', value: 0.9079999999999999}, 
							{key: 'Energy', value: 0.621}, 
							{key: 'Loudness', value: 0.200971323}, 
							{key: 'Valence', value: 0.42100000000000004}, 
							{key: 'Tempo', value: 0.655652074}, 
							{key: 'Acousticness', value: 0.00028199999999999997}, 
							{key: 'Speechiness', value: 0.102}, 
							{key: 'Track Popularity', value: 0.975308642}];

			var despacito = [{key: 'Danceability', value: 0.653}, 
							{key: 'Energy', value: 0.816}, 
							{key: 'Loudness', value: 0.7294172059999999}, 
							{key: 'Valence', value: 0.816}, 
							{key: 'Tempo', value: 0.924240395}, 
							{key: 'Acousticness', value: 0.228}, 
							{key: 'Speechiness', value: 0.16699999999999998}, 
							{key: 'Track Popularity', value: 0.9259259259999999}];

			var shapeofyou = [{key: 'Danceability', value: 0.825}, 
								{key: 'Energy', value: 0.652}, 
								{key: 'Loudness', value: 1.0}, 
								{key: 'Valence', value: 0.9309999999999999}, 
								{key: 'Tempo', value: 0.138718812}, 
								{key: 'Acousticness', value: 0.581}, 
								{key: 'Speechiness', value: 0.0802}, 
								{key: 'Track Popularity', value: 0.9135802470000001}];

			var all_dsi = [{key: 'Danceability', value: 0.622}, 
								{key: 'Energy', value: 0.647}, 
								{key: 'Loudness', value: 0.855690410355544}, 
								{key: 'Valence', value: 0.43799999999999994}, 
								{key: 'Tempo', value: 0.427017144227311}, 
								{key: 'Acousticness', value: 0.138}, 
								{key: 'Speechiness', value: 0.0493}, 
								{key: 'Track Popularity', value: 0.52}];


			var resultdata = song_value
			if (song_value == "humble"){
				resultdata = humble;
			}
			if (song_value == "shape of you"){
				resultdata = shapeofyou;
			}
			if (song_value == "starboy"){
				resultdata = starboy;
			}


			//  Width and height of svg
			var w = 900;
			var h = 500;
			var margin = {top: 30, right: 140, bottom: 30,
      		left: 30};
  			var innerWidth = w - margin.left - margin.right;
  			var innerHeight = h - margin.top - margin.bottom;

			// y-axis min / max
		  	var ymin = 0.0;
		  	var ymax = 1.0;
		
			//		Scale functions
			var xScale = d3.scaleBand()
				.domain(['Danceability', 'Energy', 'Loudness', 'Valence', 'Tempo', 'Acousticness', 'Speechiness', 'Track Popularity'])
				.range([0, innerWidth])
				.paddingInner(.1);

			var yScale = d3.scaleLinear()
				.domain([ymin, ymax])
				.range([innerHeight, 0]);
			
			//    Define X axis and Y axis
			var xAxis = d3.axisBottom()
				.scale(xScale);

			var yAxis = d3.axisLeft()
				.scale(yScale);

			//    Create SVG element		
			var svg = d3.select("body")
				.append("svg")
				.attr("width", w)
				.attr("height", h)

			// svg.append("rect")
			// 	.attr("x", 0)
			// 	.attr("y", 0)
			// 	.attr("width", w)
			// 	.attr("height", h)
			// 	.attr("fill", "white");				
			
			//    Create axes
			svg.append("g")
				.attr("class", "yAxis")
				.attr("transform", `translate (${margin.left}, ${margin.top})`)
				.call(yAxis.ticks(10));

			svg.append("g")
				.attr("class", "xAxis")
				.attr("transform", `translate (${margin.left}, ${h - margin.bottom})`)
				.call(xAxis);
			
			//	Create initial bars
			var bardata = [{key: 'Danceability', value:.05}, 
							{key: 'Energy', value:.05},
							{key: 'Loudness', value: .05}, 
							{key: 'Valence', value:.05}, 
							{key: 'Tempo', value:.05}, 
							{key: 'Acousticness', value:.05},
							{key: 'Speechiness', value:.05}, 
							{key: 'Track Popularity', value:.05}];


			var bars = svg.append("g")
				.attr("class", "plot")
				.attr("transform", `translate (${margin.left}, ${margin.top})`)
				.selectAll("rect")
				.data(bardata, d => d.key);

			bars.enter().append("rect")
				.attr("x", d => xScale(d.key))
				.attr("y", d => yScale(d.value))
				.attr("width", xScale.bandwidth())
				.attr("height", d => innerHeight - yScale(d.value))
				.attr("fill", "#FA7268")
				.call(d3.drag()
					.on("start", dragstart)
					.on("drag", dragging)
					.on("end", dragend));

			function dragstart(d){
				d3.select(this).raise().classed("active", true);
			};

			function dragging(d){
				d3.select(this)
					.attr("y", d.y = d3.event.y)
					.attr("height", d => innerHeight - d3.event.y);
			};

			function dragend(d){
				d3.select(this).classed("active", false);
			};

			//	This function isn't working right now, not selecting the bars, eventually it should add new bars with the actual values, was just using color to test the functionality of this

			function results(){
				svg.select(".plot").selectAll("rect")
				.transition()
				.duration(1500)
				.style("fill-opacity", .5)
				// .style("stroke", "black")
				.style("stroke-width", 1);

				var bars = svg.append("g")
					.attr("class", "results")
					.attr("transform", `translate (${margin.left}, ${margin.top})`)
					.selectAll("rect")
					.data(resultdata, d => d.key);

				bars.enter()
					.append("rect")
					.attr("x", d => xScale(d.key))
					.attr("y", d => yScale(d.value))
					.attr("width", xScale.bandwidth())
					.attr("height", d => innerHeight - yScale(d.value))
					.attr("fill", "#ffcc66")
					.attr("fill-opacity", 0)
					.transition()
					.delay(1500)
					.duration(1500)
					.attr("fill-opacity", .6);

				svg.append("text")
					.text("Actual Values")
					.style("fill", "#F8AD00")
					.style("font-size", 12)
					.attr("x", innerWidth+margin.left+10)
					.attr("y", yScale(resultdata.slice(-1)[0]["value"])+margin.top )
					.attr("fill-opacity", 0)
					.transition()
					.delay(2800)
					.attr("fill-opacity", 1);

				var lines = svg.append("g")
					.attr("class", "all_dsi")
					.attr("transform", `translate (${margin.left}, ${margin.top})`)
					.selectAll("line")
					.data(all_dsi, d => d.key);

				lines.enter()
					.append("line")
					.attr("x1", d => xScale(d.key))
					.attr("y1", d => yScale(d.value))
					.attr("x2", d => xScale(d.key)+ xScale.bandwidth())
					.attr("y2", d => yScale(d.value))
					.style("stroke-width", 3)
					.style("stroke-dasharray", 4)
					.style("stroke", "#006666")
					.attr("stroke-opacity", 0)
					.transition()
					.delay(5000)
					.duration(1000)
					.attr("stroke-opacity", 1);


				svg.append("text")
					.text("Median of all DSI songs")
					.style("fill", "#006666")
					.style("font-size", 12)
					.attr("x", innerWidth+margin.left+10)
					.attr("y", yScale(all_dsi.slice(-1)[0]["value"])+margin.top )
					.attr("fill-opacity", 0)
					.transition()
					.delay(5800)
					.attr("fill-opacity", 1);

			}

			//	 Not done yet!
			function restart(){

			}

		</script>

		<!-- Would be nice to change button sizes to be bigger!! Add restart function -->
		<div class = "submit">
	  		<input type="button" value="Submit" onclick="results()"/>
		</div>

		<div class = "restart">
	  		<input type="button" value="Play Again" onclick="restart()"/>
		</div>

		<p></p>
	</body>
</html>